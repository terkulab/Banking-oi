<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern Banking App</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
body{background:#f0f2f5;min-height:100vh;}
button{cursor:pointer;}
/* LOGIN */
#loginSection{display:flex;justify-content:center;align-items:center;height:100vh;}
.login-box{background:#fff;padding:40px;border-radius:12px;box-shadow:0 15px 40px rgba(0,0,0,0.15);width:100%;max-width:400px;text-align:center;}
.login-box input, .login-box button{width:100%;padding:14px;margin:12px 0;border-radius:8px;border:1px solid #ccc;font-size:16px;}
.login-box button{background:linear-gradient(90deg,#0A2540,#1b3b70);color:#fff;font-weight:600;border:none;transition:0.3s;}
.login-box button:hover{opacity:0.9;}
.login-box h2{color:#0A2540;margin-bottom:20px;}
/* DASHBOARD */
#dashboardSection{display:none;display:flex;min-height:100vh;transition:all 0.3s;}
.sidebar{width:250px;background:#0A2540;color:#fff;padding:20px;transition:all 0.3s;position:fixed;left:0;top:0;height:100vh;}
.sidebar h3{margin-bottom:20px;}
.sidebar button{width:100%;padding:12px;margin:6px 0;border:none;border-radius:8px;background:#1b3b70;color:#fff;font-weight:600;transition:0.3s;}
.sidebar button:hover{background:#27468b;}
.main-content{margin-left:260px;padding:20px;transition:all 0.3s;width:100%;}
.card{background:#fff;padding:25px;margin:15px 0;border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,0.1);}
.card h3{color:#0A2540;margin-bottom:15px;}
.flex button{margin-right:12px;padding:10px 20px;border-radius:8px;border:none;font-weight:600;background:linear-gradient(90deg,#0A2540,#1b3b70);color:#fff;transition:0.3s;}
.flex button:hover{opacity:0.9;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:12px;border:1px solid #ccc;text-align:left;}
th{background:#0A2540;color:#fff;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
.modal-content{background:#fff;padding:30px;border-radius:12px;width:90%;max-width:400px;position:relative;}
.modal-content input, .modal-content button{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid #ccc;}
.modal-content button{background:linear-gradient(90deg,#0A2540,#1b3b70);color:#fff;font-weight:600;border:none;}
.modal .close{position:absolute;top:10px;right:10px;background:red;color:#fff;padding:5px 10px;border:none;border-radius:50%;cursor:pointer;}
.hamburger{display:none;position:absolute;top:20px;left:20px;background:#0A2540;color:#fff;padding:10px 12px;border-radius:8px;font-size:18px;}
@media(max-width:768px){.sidebar{left:-260px;}.sidebar.active{left:0;}.main-content{margin-left:0;padding:20px 10px;}.hamburger{display:block;}}
.badge{padding:4px 10px;border-radius:8px;color:#fff;font-weight:600;font-size:12px;}
.badge.pending{background:#f0ad4e;}
.badge.approved{background:#5cb85c;}
.badge.rejected{background:#d9534f;}
</style>
</head>
<body>

<!-- HAMBURGER -->
<button class="hamburger" id="hamburger">&#9776;</button>

<!-- LOGIN -->
<section id="loginSection">
  <div class="login-box">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
  </div>
</section>

<!-- DASHBOARD -->
<section id="dashboardSection">
  <div class="sidebar" id="sidebar">
    <h3 id="menuTitle">Menu</h3>
    <div id="menuItems"></div>
  </div>
  <div class="main-content" id="mainContent">
    <!-- USER DASHBOARD -->
    <div id="dashboardContent" class="card">
      <h3>User Dashboard</h3>
      <p><b>Name:</b> <span id="userName"></span></p>
      <p><b>Balance:</b> $<span id="userBalance"></span></p>
      <p><b>Account Number:</b> <span id="userAccount"></span></p>
      <p><b>KYC Status:</b> <span id="userKYC"></span></p>
      <div class="flex">
        <button id="depositBtn">Deposit</button>
        <button id="transferBtn">Transfer</button>
        <button id="withdrawBtn">Withdraw</button>
      </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div id="adminContent" class="card" style="display:none;">
      <h3>Admin Panel - Add User</h3>
      <input type="text" id="addUserName" placeholder="Name">
      <input type="email" id="addUserEmail" placeholder="Email">
      <input type="password" id="addUserPass" placeholder="Password">
      <input type="text" id="addUserAccount" placeholder="Account Number">
      <input type="number" id="addUserBalance" placeholder="Initial Balance">
      <input type="text" id="addUserAddress" placeholder="Payment Address">
      <button id="addUserBtn">Add User</button>

      <h3>Pending Transactions</h3>
      <table>
        <thead><tr><th>User ID</th><th>Type</th><th>Amount</th><th>Address</th><th>Action</th></tr></thead>
        <tbody id="pendingTable"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <button class="close" id="modalClose">X</button>
    <h3 id="modalTitle">Action</h3>
    <input type="number" id="modalAmount" placeholder="Enter amount">
    <input type="text" id="modalAddress" placeholder="Payment Address (for Transfer/Withdrawal)">
    <button id="modalConfirm">Confirm</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, setDoc, doc, getDoc, getDocs, updateDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

// FIREBASE CONFIG
const firebaseConfig = {  
  apiKey: "AIzaSyCpGwKbyOW_LQPrTKoNvDjW_oTD9_cxsnc",  
  authDomain: "n26-bank-888bc.firebaseapp.com",  
  projectId: "n26-bank-888bc",  
  storageBucket: "n26-bank-888bc.appspot.com",  
  messagingSenderId: "112126821080",  
  appId: "1:112126821080:web:e455b16ffc29164d290dad"  
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ELEMENTS
const loginSection=document.getElementById('loginSection');
const dashboardSection=document.getElementById('dashboardSection');
const emailInput=document.getElementById('email');
const passwordInput=document.getElementById('password');
const loginBtn=document.getElementById('loginBtn');
const menuItems=document.getElementById('menuItems');
const hamburger=document.getElementById('hamburger');
const sidebar=document.getElementById('sidebar');

const dashboardContent=document.getElementById('dashboardContent');
const adminContent=document.getElementById('adminContent');

const userNameEl=document.getElementById('userName');
const userBalanceEl=document.getElementById('userBalance');
const userAccountEl=document.getElementById('userAccount');
const userKYCEl=document.getElementById('userKYC');

const depositBtn=document.getElementById('depositBtn');
const transferBtn=document.getElementById('transferBtn');
const withdrawBtn=document.getElementById('withdrawBtn');

const modal=document.getElementById('modal');
const modalClose=document.getElementById('modalClose');
const modalTitle=document.getElementById('modalTitle');
const modalAmount=document.getElementById('modalAmount');
const modalAddress=document.getElementById('modalAddress');
const modalConfirm=document.getElementById('modalConfirm');

const addUserBtn=document.getElementById('addUserBtn');
const pendingTable=document.getElementById('pendingTable');

let currentUser;
const adminUser = {email:"admin@bankapp.com",password:"Admin1234!",uid:"admin123",name:"Admin User",role:"admin"};

hamburger.onclick=()=>{sidebar.classList.toggle('active');}

// LOGIN
loginBtn.onclick=async()=>{
  const email=emailInput.value.trim();
  const password=passwordInput.value.trim();
  if(!email||!password){alert("Enter email & password");return;}
  
  if(email===adminUser.email && password===adminUser.password){
    currentUser=adminUser;
    loginSection.style.display="none";
    dashboardSection.style.display="flex";
    adminContent.style.display="block";
    dashboardContent.style.display="none";
    renderMenu('admin');
    loadPendingTransactions();
    return;
  }

  try{
    const userCred = await signInWithEmailAndPassword(auth,email,password);
    const snap = await getDoc(doc(db,"users",userCred.user.uid));
    if(!snap.exists()){alert("User not found");return;}
    const data=snap.data();
    currentUser={uid:userCred.user.uid,...data};
    loginSection.style.display="none";
    dashboardSection.style.display="flex";
    if(data.role==="admin"){
      adminContent.style.display="block";
      dashboardContent.style.display="none";
      renderMenu('admin');
      loadPendingTransactions();
    }else{
      dashboardContent.style.display="block";
      adminContent.style.display="none";
      renderMenu('user');
      loadUserDashboard();
    }
  }catch(e){alert("Login failed: "+e.message);}
};

// MENU
function renderMenu(role){
  menuItems.innerHTML="";
  if(role==="admin"){
    menuItems.innerHTML+=`<button id="menuDashboard">Dashboard</button>
                            <button id="menuAddUser">Add User</button>
                            <button id="menuPending">Pending Transactions</button>
                            <button id="logoutBtn">Logout</button>`;
    document.getElementById('menuDashboard').onclick=()=>{dashboardContent.style.display='none';adminContent.style.display='block';};
    document.getElementById('menuAddUser').onclick=()=>{dashboardContent.style.display='none';adminContent.style.display='block';};
    document.getElementById('menuPending').onclick=()=>{dashboardContent.style.display='none';adminContent.style.display='block';loadPendingTransactions();};
    document.getElementById('logoutBtn').onclick=logout;
  }else{
    menuItems.innerHTML+=`<button id="menuDashboard">Dashboard</button>
                            <button id="menuLogout">Logout</button>`;
    document.getElementById('menuDashboard').onclick=()=>{dashboardContent.style.display='block';};
    document.getElementById('menuLogout').onclick=logout;
  }
}

// LOGOUT
function logout(){currentUser=null;dashboardSection.style.display='none';loginSection.style.display='flex';emailInput.value='';passwordInput.value='';}

// USER DASHBOARD
function loadUserDashboard(){
  userNameEl.innerText=currentUser.name;
  userBalanceEl.innerText=currentUser.balance;
  userAccountEl.innerText=currentUser.accountNumber||"-";
  userKYCEl.innerText=currentUser.KYC||"Not uploaded";

  depositBtn.onclick=()=>{openModal('Deposit');};
  transferBtn.onclick=()=>{openModal('Transfer');};
  withdrawBtn.onclick=()=>{openModal('Withdraw');};
}

// MODAL
function openModal(type){
  modalTitle.innerText=type;
  modalAmount.value="";
  modalAddress.value="";
  modal.style.display="flex";

  modalConfirm.onclick = async ()=>{
    let amt=parseFloat(modalAmount.value);
    let addr=modalAddress.value.trim();
    if(isNaN(amt)||amt<=0){alert("Invalid amount");return;}
    let status=(type==="Deposit")?"approved":"pending";

    if(type==="Deposit"){
      currentUser.balance+=amt;
      await updateDoc(doc(db,"users",currentUser.uid),{balance:currentUser.balance});
      userBalanceEl.innerText=currentUser.balance;
      alert("Deposit successful!");
    }

    await addDoc(collection(db,"transactions"),{
      userId:currentUser.uid,
      type:type,
      amount:amt,
      address:addr||null,
      status:status,
      timestamp:serverTimestamp()
    });

    if(type!=="Deposit"){alert(`${type} request is pending admin approval`);}
    modal.style.display="none";
  };
}
modalClose.onclick=()=>{modal.style.display="none";};

// ADMIN FUNCTIONS
addUserBtn.onclick=async()=>{
  const name=document.getElementById('addUserName').value.trim();
  const email=document.getElementById('addUserEmail').value.trim();
  const pass=document.getElementById('addUserPass').value.trim();
  const account=document.getElementById('addUserAccount').value.trim();
  const balance=parseFloat(document.getElementById('addUserBalance').value.trim()||0);
  const address=document.getElementById('addUserAddress').value.trim();
  if(!name||!email||!pass){alert("Fill all fields");return;}
  try{
    const userCred=await createUserWithEmailAndPassword(auth,email,pass);
    await setDoc(doc(db,"users",userCred.user.uid),{
      name,email,role:"user",balance,accountNumber:account,paymentAddress:address,KYC:"Not uploaded"
    });
    alert("User added successfully!");
  }catch(e){alert("Failed: "+e.message);}
};

async function loadPendingTransactions(){
  pendingTable.innerHTML="";
  const snap=await getDocs(collection(db,"transactions"));
  snap.forEach(d=>{
    const t=d.data();
    if(t.status==="pending"){
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${t.userId}</td>
                     <td>${t.type}</td>
                     <td>$${t.amount}</td>
                     <td>${t.address||'-'}</td>
                     <td>
                      <button onclick="approveTransaction('${d.id}',${t.amount},'${t.userId}')">Approve</button>
                      <button onclick="rejectTransaction('${d.id}')">Reject</button>
                     </td>`;
      pendingTable.appendChild(tr);
    }
  });
}

window.approveTransaction=async(id,amt,uid)=>{
  await updateDoc(doc(db,"transactions",id),{status:"approved"});
  const userRef=doc(db,"users",uid);
  const snap=await getDoc(userRef);
  if(snap.exists()){
    const data=snap.data();
    await updateDoc(userRef,{balance:data.balance-amt});
  }
  loadPendingTransactions();
  alert("Transaction approved!");
}

window.rejectTransaction=async(id)=>{
  await updateDoc(doc(db,"transactions",id),{status:"rejected"});
  loadPendingTransactions();
  alert("Transaction rejected!");
}
</script>
</body>
</html>
