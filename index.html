<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N26 Bank – Firebase Banking App</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f4f6f8}
.hidden{display:none}
.sidebar{width:230px;background:#0b2c4a;color:#fff;padding:20px;position:fixed;left:-240px;top:0;height:100vh;transition:.3s}
.sidebar.active{left:0}
.sidebar a{display:block;color:#fff;text-decoration:none;padding:10px;border-radius:6px;margin-bottom:6px}
.sidebar a:hover{background:#144a7c}
.main{padding:20px}
.card{background:#fff;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,.15)}
.btn{padding:10px 14px;border:none;border-radius:6px;cursor:pointer}
.btn-primary{background:#0b2c4a;color:#fff}
.btn-success{background:#27ae60;color:#fff}
.btn-danger{background:#c0392b;color:#fff}
.menu-btn{font-size:22px;cursor:pointer}
.login-box{max-width:360px;margin:120px auto;background:#fff;padding:30px;border-radius:10px}
input{width:100%;padding:10px;margin:8px 0}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px}
.badge{padding:4px 10px;border-radius:12px;font-size:12px}
.ok{background:#27ae60;color:#fff}
.pending{background:#f39c12;color:#fff}
.toast{position:fixed;bottom:20px;right:20px;background:#0b2c4a;color:#fff;padding:12px;border-radius:8px;display:none}
</style>
</head>
<body>

<div id="toast" class="toast"></div>

<!-- LOGIN -->
<section id="loginPage" class="login-box">
<h2>N26 Bank Login</h2>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Password">
<button class="btn btn-primary" onclick="login()">Login</button>
<p id="loginError" style="color:red"></p>
</section>

<!-- SIDEBAR -->
<nav id="sidebar" class="sidebar">
<h3>N26 Bank</h3>
<a onclick="show('dashboard')">Dashboard</a>
<a onclick="show('kyc')">KYC</a>
<a onclick="show('history')">History</a>
<a onclick="show('admin')">Admin Panel</a>
<a onclick="logout()">Logout</a>
</nav>

<!-- APP -->
<main id="app" class="main hidden">
<div class="menu-btn" onclick="sidebar.classList.toggle('active')">☰</div>

<section id="dashboard" class="card">
<h3>Dashboard</h3>
<p><b>Email:</b> <span id="uEmail"></span></p>
<p>KYC Status: <span id="kycStatus" class="badge pending">Pending</span></p>
<h2>Balance: $<span id="balance">0</span></h2>
<button class="btn btn-success" onclick="createTx('Deposit')">Deposit</button>
<button class="btn btn-danger" onclick="createTx('Withdrawal')">Withdraw</button>
</section>

<section id="kyc" class="card hidden">
<h3>KYC Upload</h3>
<input type="file" id="kycFile">
<button class="btn btn-primary" onclick="submitKYC()">Submit KYC</button>
</section>

<section id="history" class="card hidden">
<h3>Transaction History</h3>
<div id="txList"></div>
</section>

<section id="admin" class="card hidden">
<h3>Admin Panel – N26 Bank</h3>
<h4>Add User</h4>
<input id="newEmail" placeholder="User Email">
<input id="newPass" placeholder="Password">
<input id="newBalance" type="number" placeholder="Initial Balance">
<button class="btn btn-primary" onclick="adminAddUser()">Add User</button>

<h4>Pending Transactions</h4>
<table>
<thead><tr><th>User</th><th>Type</th><th>Amount</th><th>Action</th></tr></thead>
<tbody id="pendingTx"></tbody>
</table>
</section>
</main>

<script>
/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCpGwKbyOW_LQPrTKoNvDjW_oTD9_cxsnc",
  authDomain: "n26-bank-888bc.firebaseapp.com",
  projectId: "n26-bank-888bc",
  storageBucket: "n26-bank-888bc.appspot.com",
  messagingSenderId: "112126821080",
  appId: "1:112126821080:web:c108cc61d84a25f5290dad"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// SECONDARY APP (CRITICAL FIX)
const secondaryApp = firebase.initializeApp(firebaseConfig, "Secondary");
const secondaryAuth = firebase.auth(secondaryApp);

const adminEmail = "admin@bankapp.com";
let currentUser;

const toastMsg = msg => {toast.innerText=msg;toast.style.display='block';setTimeout(()=>toast.style.display='none',2500)};
function show(id){['dashboard','kyc','history','admin'].forEach(x=>document.getElementById(x).classList.add('hidden'));document.getElementById(id).classList.remove('hidden');sidebar.classList.remove('active')}

async function login(){
 try{
  const res = await auth.signInWithEmailAndPassword(loginEmail.value, loginPass.value);
  currentUser=res.user;
  loginPage.classList.add('hidden'); app.classList.remove('hidden');
  uEmail.innerText=currentUser.email;
  if(currentUser.email===adminEmail) show('admin'); else show('dashboard');
  loadUser();
 }catch(e){loginError.innerText=e.message}
}

function logout(){auth.signOut().then(()=>location.reload())}

async function loadUser(){
 const snap = await db.collection('users').doc(currentUser.uid).get();
 if(snap.exists){
  const d=snap.data();
  balance.innerText=d.balance||0;
  kycStatus.innerText=d.kyc||'Pending';
  kycStatus.className='badge '+(d.kyc==='Verified'?'ok':'pending');
 }
 loadTx();
}

async function submitKYC(){
 const file=kycFile.files[0]; if(!file) return alert('Upload file');
 const ref=storage.ref(`kyc/${currentUser.uid}`);
 await ref.put(file);
 const url=await ref.getDownloadURL();
 await db.collection('users').doc(currentUser.uid).set({kyc:'Submitted',kycFile:url},{merge:true});
 toastMsg('KYC submitted'); loadUser();
}

async function createTx(type){
 const amt=+prompt('Amount'); if(!amt) return;
 await db.collection('transactions').add({uid:currentUser.uid,email:currentUser.email,type,amount:amt,status:'Pending',time:Date.now()});
 toastMsg('Transaction pending'); loadTx();
}

async function loadTx(){
 txList.innerHTML='';
 const q=await db.collection('transactions').where('uid','==',currentUser.uid).get();
 q.forEach(d=>{const t=d.data();txList.innerHTML+=`<p>${t.type}: $${t.amount} - <b>${t.status}</b></p>`});
 if(currentUser.email===adminEmail) loadPending();
}

async function loadPending(){
 pendingTx.innerHTML='';
 const q=await db.collection('transactions').where('status','==','Pending').get();
 q.forEach(doc=>{const t=doc.data();pendingTx.innerHTML+=`<tr><td>${t.email}</td><td>${t.type}</td><td>$${t.amount}</td><td><button onclick="approveTx('${doc.id}',${t.amount},'${t.uid}')">Approve</button></td></tr>`});
}

async function approveTx(id,amt,uid){
 const uref=db.collection('users').doc(uid);
 await db.runTransaction(async tr=>{
  const us=await tr.get(uref);
  tr.update(uref,{balance:(us.data().balance||0)+amt});
  tr.update(db.collection('transactions').doc(id),{status:'Approved'});
 });
 toastMsg('Transaction approved'); loadPending(); loadUser();
}

async function adminAddUser(){
 const email=newEmail.value.trim();
 const pass=newPass.value.trim();
 const bal=+newBalance.value||0;
 if(!email||!pass) return alert('Fill all fields');
 try{
  const cred=await secondaryAuth.createUserWithEmailAndPassword(email,pass);
  await db.collection('users').doc(cred.user.uid).set({balance:bal,kyc:'Pending',bank:'N26 Bank'});
  secondaryAuth.signOut();
  toastMsg('User added successfully');
 }catch(e){alert(e.message)}
}
</script>
</body>
  </html>
